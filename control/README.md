# control/

This directory is used internally by **PHOST CLI** to store runtime and state
information required for safe operation, diagnostics, and resiliency.

⚠️ **Important:**  
Files inside this directory are **generated automatically**.  
They should **not be edited manually** unless you know exactly what you are doing.

---

## Purpose

The `control/` directory allows PHOST to:

- Track which services are running
- Prevent multiple CLI executions at the same time
- Store detected environment data (ports, paths, versions)
- Improve stability compared to classic stacks like XAMPP
- Enable fast `status` and `doctor` commands

This directory is part of PHOST’s **CLI-first and resilient design**.

---

## Files Overview

### `state.json`

Stores the **logical state** of the PHOST stack.

**Used by:**
- `phost up`
- `phost down`
- `phost status`

**Contains:**
- Service states (nginx, apache, mariadb, php)
- Last executed action
- Timestamp of last update

**Example:**
```json
{
  "nginx": "running",
  "apache": "running",
  "mariadb": "stopped",
  "php": "loaded",
  "last_action": "up",
  "updated_at": "2025-12-20T13:40:00"
}
````

---

### `runtime.json`

Stores **detected system and environment information**.

**Generated by:**

* `phost doctor`

**Contains:**

* Ports in use
* Paths to binaries
* Detected versions
* Validation results

**Example:**

```json
{
  "ports": {
    "nginx": 80,
    "apache": 8080,
    "mariadb": 3306
  },
  "paths": {
    "nginx": "bin/nginx/nginx.exe",
    "apache": "bin/apache/bin/httpd.exe",
    "mariadb": "bin/mariadb/bin/mysqld.exe",
    "php": "bin/php/php.exe"
  },
  "versions": {
    "php": "8.3.1",
    "mariadb": "10.11"
  }
}
```

---

### `phost.lock`

Prevents **multiple PHOST CLI instances** from running simultaneously.

**Purpose:**

* Avoid starting services twice
* Prevent data corruption
* Protect InnoDB and logs

**Created when:**

* PHOST CLI starts

**Removed when:**

* PHOST exits cleanly
* `phost down` is executed

**Example content:**

```
PID=12345
STARTED=2025-12-20T13:41:00
```

If this file exists and PHOST is not running, it is safe to delete it manually.

---

## Files NOT stored here

The following **must never be placed** in `control/`:

* Binaries or executables
* Manual configuration files
* Logs
* Backups

Those belong to:

* `/bin`
* `/logs`
* `/backups`

---

## Version Control

Generated files must **not be committed**.

Recommended `.gitignore` rules:

```gitignore
/control/*.json
/control/*.lock
/control/*.pid
```

---

## Design Philosophy

> **lib executes**
> **commands orchestrate**
> **control remembers**

This separation is intentional and aligns PHOST with professional tooling
such as Docker, PM2, and modern CLI-based platforms.

---

## Notes

* All files in this directory can be safely regenerated
* Deleting this directory resets PHOST state
* This design improves stability over traditional local stacks

---

PHOST Control Directory
CLI-first · Resilient · Deterministic
